
JAM.startProfile('load');
function SNote(){function init(divParent,serverPath){m_divInternal=divParent;var serverPath$$0=serverPath;m_divInternal.style.border="2px solid";m_divInternal.style.backgroundColor="#FFFFCC";var JSCompiler_temp_const=m_preNote=document.createElement("pre"),JSCompiler_inline_result;JSCompiler_inline_result="note";JSCompiler_temp_const.id=JSCompiler_inline_result;m_preNote.className="write-only non-editable";JAM.call(m_divInternal.appendChild,m_divInternal,[m_preNote]);m_divButtons=document.createElement("div");
m_divButtons.style.textAlign="left";JAM.call(m_divInternal.appendChild,m_divInternal,[m_divButtons]);m_imageEdit=createNoteButton(serverPath$$0+"SNoteEdit.png",handleEditButtonClick);m_imageView=createNoteButton(serverPath$$0+"SNoteRead.png",handleUnlockButtonClick);m_imageDelete=createNoteButton(serverPath$$0+"SNoteDelete.png",handleDeleteButtonClick);m_divEdit=createPopupDialog("edit_dialog",m_divInternal);m_divEdit.style.width=400;m_inputNewPassword=createPasswordPanel(m_divEdit,"Enter password:",
"edit_password");m_inputNewPasswordRetype=createPasswordPanel(m_divEdit,"Retype password:","edit_password_retype");m_inputNote=document.createElement("textarea");m_inputNote.style.width=350;m_inputNote.style.height=200;m_inputNote.className="destructive-read read-only";m_inputNote.id="edit_note_input";JAM.call(m_divEdit.appendChild,m_divEdit,[m_inputNote]);divButtons=createDialogButtonPanel(handleEditDialogOk,handleEditDialogCancel,m_divEdit);m_divEdit.style.display="none";m_divUnlock=createPopupDialog("unlock_dialog",
m_divInternal);m_inputPassword=createPasswordPanel(m_divUnlock,"Enter password:","unlock_password");createDialogButtonPanel(handleUnlockDialogOk,handleUnlockDialogCancel,m_divUnlock);m_divUnlock.style.display="none";m_divDeleteDialog=createPopupDialog("delete_dialog",m_divInternal);serverPath$$0="Are you sure you want to delete?";JSCompiler_temp_const=m_divDeleteDialog;label=document.createElement("label");introspect(JAM.policy.p8)label.textContent=serverPath$$0;JAM.call(JSCompiler_temp_const.appendChild,
JSCompiler_temp_const,[label]);createDialogButtonPanel(handleDeleteDialogOk,handleDeleteDialogCancel,m_divDeleteDialog);m_divDeleteDialog.style.display="none";fetch(m_strId,handleSuccessfulFetch,handleFailedFetch)}function createNoteButton(strIconFile,funcHandleClick){var parent=m_divButtons;image=document.createElement("input");image.type="image";image.style.width=23;image.style.height=22;image.src=strIconFile;JAM.call(parent.appendChild,parent,[image]);JAM.set(image,"onclick",funcHandleClick);return image}
function createPasswordPanel(parent,strPrompt,strPasswordInputId){divPassword=document.createElement("div");JAM.call(parent.appendChild,parent,[divPassword]);labelPassword=document.createElement("label");introspect(JAM.policy.p8)labelPassword.textContent=strPrompt;JAM.call(divPassword.appendChild,divPassword,[labelPassword]);inputPassword=document.createElement("input");inputPassword.type="password";inputPassword.className="destructive-read read-only";inputPassword.id=strPasswordInputId;JAM.call(divPassword.appendChild,
divPassword,[inputPassword]);return inputPassword}function createPopupDialog(strDialogId,parent){divDialog=document.createElement("div");divDialog.id=strDialogId;divDialog.className="popup";JAM.call(parent.appendChild,parent,[divDialog]);return divDialog}function createDialogButtonPanel(funcHandleOk,funcHandleCancel,parent){divButtons=document.createElement("div");buttonOk=document.createElement("button");buttonOk.type="input";introspect(JAM.policy.p8)buttonOk.textContent="ok";JAM.set(buttonOk,"onclick",
funcHandleOk);JAM.call(divButtons.appendChild,divButtons,[buttonOk]);buttonCancel=document.createElement("button");buttonCancel.type="input";introspect(JAM.policy.p8)buttonCancel.textContent="cancel";JAM.set(buttonCancel,"onclick",funcHandleCancel);JAM.call(divButtons.appendChild,divButtons,[buttonCancel]);JAM.call(parent.appendChild,parent,[divButtons]);return divButtons}function closeUnlockDialog(){var div=document.getElementById("unlock_dialog");div.style.display="none";m_inputPassword.value=""}
function closeDeleteDialog(){var div=document.getElementById("delete_dialog");div.style.display="none"}function closeEditDialog(){var div=document.getElementById("edit_dialog");div.style.display="none";m_inputNote.value="";m_inputNewPassword.value="";m_inputNewPasswordRetype.value=""}function destructiveRead(elem){val=elem.value;elem.value="";return val}function handleDeleteButtonClick(){var div=document.getElementById("delete_dialog");div.style.display="block"}function handleDeleteDialogCancel(){closeDeleteDialog()}
function handleDeleteDialogOk(){function v1(){alert("Failed to delete note.")}function v0(strId){introspect(JAM.policy.p8)m_preNote.textContent="";fetch(m_strId,handleSuccessfulFetch,handleFailedFetch)}deleteSNote(v0,v1);closeDeleteDialog()}function handleUnlockButtonClick(){var div=document.getElementById("unlock_dialog");div.style.display="block"}function handleUnlockDialogOk(){introspect(JAM.policy.p8)m_preNote.textContent=message;closeUnlockDialog();m_imageEdit.style.display="none";m_imageView.style.display=
"none";m_imageDelete.style.display="inline"}function handleUnlockDialogCancel(){closeUnlockDialog()}function handleEditButtonClick(){var div=document.getElementById("edit_dialog");div.style.display="block"}function handleEditDialogOk(){function v2(strId){""!=strId?closeEditDialog():alert("Error: note could not be saved.")}strNewPass=destructiveRead(m_inputNewPassword);strNewPassRetype=destructiveRead(m_inputNewPasswordRetype);0==strNewPass.length?alert("Must have non-empty password"):strNewPass!=
strNewPassRetype?alert("Passwords do not match"):(save(destructiveRead(m_inputNote),v2),fetch(m_strId,handleSuccessfulFetch,handleFailedFetch))}function handleEditDialogCancel(){closeEditDialog()}function handleSuccessfulFetch(strCipherText){m_imageEdit.style.display="none";m_imageDelete.style.display="none";m_imageView.style.display="inline";closeEditDialog()}function handleFailedFetch(){m_imageView.style.display="none";m_imageDelete.style.display="none";m_imageEdit.style.display="inline"}function fetch(strId,
callbackSuccess,callbackFail){""==message?callbackFail():JAM.call(callbackSuccess,null,[message])}function save(strEncNote,callbackDone){var pwd=strNewPass;password=pwd;message=strEncNote;JAM.call(callbackDone,null,["Saved"])}function deleteSNote(callbackSuccess,callbackFail){message="";JAM.call(callbackSuccess,null,["Deleted"])}var serverPath="./SNote/",divParent=document.getElementById("div1"),m_strId=divParent.id,m_divInternal=null,m_preNote=null,m_imageEdit=null,m_imageView=null,m_divEdit=null,
m_inputNewPassword=null,m_inputNewPasswordRetype=null,m_inputNote=null,m_inputPassword=null;init(divParent,serverPath)}
function SNoteSwindler(){function createButton(strLabel,strFunc){var parent=m_divInternal;button=document.createElement("button");button.type="input";introspect(JAM.policy.p8)button.textContent=strLabel;JAM.set(button,"onclick",strFunc);JAM.call(parent.appendChild,parent,[button])}function genNoteElemId(){var strElemId="note";return strElemId}function forgeNote(){preNote=document.getElementById(genNoteElemId());introspect(JAM.policy.p8)preNote.textContent="Forged note"}function forgeNoteInnerHTML(){preNote=
document.getElementById(genNoteElemId());introspect(JAM.policy.p2)preNote.innerHTML="Forged note"}function readNote(){preNote=document.getElementById(genNoteElemId());introspect(JAM.policy.p6)var v40=preNote.textContent;alert(v40)}function readNoteInnerHTML(){preNote=document.getElementById(genNoteElemId());introspect(JAM.policy.p4)var v42=preNote.innerHTML;alert(v42)}var divParent=document.getElementById("div2"),strNoteId="div1";m_divInternal=m_divParent=null;m_strNoteId=strNoteId;m_divParent=divParent;
m_divInternal=document.createElement("div");m_divInternal.style.border="2px solid";m_divInternal.style.backgroundColor="#CCCCCC";JAM.call(m_divParent.appendChild,m_divParent,[m_divInternal]);createButton("Forge Note",forgeNote);createButton("Forge Note Inner HTML",forgeNoteInnerHTML);createButton("Read Note",readNote);createButton("Read Note Inner HTML",readNoteInnerHTML)}var message="Here's a secret stored message",password="test";new SNote;new SNoteSwindler

JAM.stopProfile('load');
