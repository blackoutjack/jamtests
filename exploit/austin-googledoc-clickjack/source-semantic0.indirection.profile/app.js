
JAM.startProfile('load');
function v9(err$$5, req$$2, res$$2, next$$2) {
  var v44 = err$$5.message;
  var v10 = {message:v44, error:{}};
  JAM.call(res$$2.render, res$$2, ["error", v10], JAM.policy.p1);
  return;
}
function v8(err$$4, req$$1, res$$1, next$$1) {
  var v45 = err$$4.message;
  var v11 = {message:v45, error:err$$4};
  JAM.call(res$$1.render, res$$1, ["error", v11], JAM.policy.p1);
  return;
}
function v7(req, res, next) {
  var err$$3 = new Error("Not Found");
  err$$3.status = 404;
  JAM.call(next, null, [err$$3]);
  return;
}
function v6(message$$10) {
  function v5(err$$2) {
    var v12 = err$$2 || "success, message deleted";
    console.log(v12);
    return;
  }
  var v13 = message$$10.title;
  ses = v13.match(/session_id\:(\w+)/);
  if (ses) {
    var v14 = message$$10.UID;
    JAM.call(mail_client.deleteMessage, mail_client, [v14, v5], JAM.policy.p1);
    var v46 = sessionStore.sessions;
    var v47 = ses[1];
    var v20 = v46[v47];
    if (v20) {
      var v68 = ses[1];
      var v62 = "Setting session: " + v68;
      var v48 = v62 + "to: ";
      var v63 = message$$10.from;
      var v49 = v63.address;
      var v15 = v48 + v49;
      console.log(v15);
      var v50 = sessionStore.sessions;
      var v51 = ses[1];
      var v16 = v50[v51];
      session_data = JSON.parse(v16);
      var v17 = message$$10.from;
      session_data.name = v17.name;
      var v18 = message$$10.from;
      session_data.email = v18.address;
      var v19 = ses[1];
      JAM.call(sessionStore.set, sessionStore, [v19, session_data], JAM.policy.p1);
    }
  }
  return;
}
function v4() {
  function v3(error$$1, info) {
    function v2(err, messages) {
      function v1(message$$9) {
        function v0(err$$1, flags$$1) {
          JAM.call(console.log, console, ["Current flags for a message: ", flags$$1], JAM.policy.p1);
          return;
        }
        var v64 = message$$9.UID;
        var v52 = v64 + ": ";
        var v53 = message$$9.title;
        var v21 = v52 + v53;
        console.log(v21);
        var v22 = message$$9.UID;
        var v23 = ["\\Seen"];
        JAM.call(mail_client.addFlags, mail_client, [v22, v23, v0], JAM.policy.p1);
        return;
      }
      messages.forEach(v1);
      return;
    }
    if (error$$1) {
      throw error$$1;
    }
    var v54 = info.count;
    var v24 = "Message count in INBOX: " + v54;
    console.log(v24);
    JAM.call(mail_client.listMessages, mail_client, [0, 0, v2], JAM.policy.p1);
    return;
  }
  JAM.call(mail_client.openMailbox, mail_client, ["INBOX", v3], JAM.policy.p1);
  return;
}
var express = require("express");
var connect = require("connect");
var googleapis = require("googleapis");
var http = require("http");
var path = require("path");
var favicon = require("static-favicon");
var logger = require("morgan");
var cookieParser = require("cookie-parser");
var bodyParser = require("body-parser");
var routes = require("./routes");
var util = require("util");
var inbox = require("inbox");
var CLIENT_ID = "some_client_id_asdfasdfasd.apps.googleusercontent.com";
var CLIENT_SECRET = "client1234secret";
var REDIRECT_URL = "urn:ietf:wg:oauth:2.0:oob";
var IMAP_EMAIL = "someemail@gmail.com";
var IMAP_PASSWORD = "somepassword";
var v55 = {user:IMAP_EMAIL, pass:IMAP_PASSWORD};
var v25 = {secureConnection:true, auth:v55};
var mail_client = JAM.call(inbox.createConnection, inbox, [false, "imap.gmail.com", v25], JAM.policy.p1);
var OAuth2Client = googleapis.OAuth2Client;
app = express();
var v26 = app;
var v73 = JAM.new(OAuth2Client, [CLIENT_ID, CLIENT_SECRET, REDIRECT_URL]);
v26.oauth2Client = v73;
var v27 = JAM.call(path.join, path, [__dirname, "views"], JAM.policy.p1);
JAM.call(app.set, app, ["views", v27], JAM.policy.p1);
JAM.call(app.set, app, ["view engine", "ejs"], JAM.policy.p1);
var v28 = favicon();
JAM.call(app.use, app, [v28]);
var v29 = JAM.call(logger, null, ["dev"]);
JAM.call(app.use, app, [v29]);
var v30 = bodyParser.json();
JAM.call(app.use, app, [v30]);
var v31 = bodyParser.urlencoded();
JAM.call(app.use, app, [v31]);
var v56 = connect.session;
var v32 = v56.MemoryStore;
sessionStore = new v32;
SITE_SECRET = "asdfasKLAJHFasdfasd";
var v33 = JAM.call(express.cookieParser, express, [SITE_SECRET]);
JAM.call(app.use, app, [v33]);
var v71 = Date.now();
var v69 = v71 + 36E5;
var v65 = new Date(v69);
var v72 = Date.now();
var v70 = v72 + 36E5;
var v66 = new Date(v70);
var v57 = {key:"express.sid", maxAge:v65, expires:v66, store:sessionStore};
var v34 = JAM.call(express.session, express, [v57]);
JAM.call(app.use, app, [v34]);
JAM.call(mail_client.on, mail_client, ["connect", v4], JAM.policy.p1);
JAM.call(mail_client.on, mail_client, ["new", v6], JAM.policy.p1);
mail_client.connect();
var v58 = require("less-middleware");
var v67 = JAM.call(path.join, path, [__dirname, "public"], JAM.policy.p1);
var v59 = {src:v67};
var v35 = JAM.call(v58, null, [v59]);
JAM.call(app.use, app, [v35]);
var v60 = JAM.call(path.join, path, [__dirname, "public"], JAM.policy.p1);
var v36 = JAM.call(express.static, express, [v60]);
JAM.call(app.use, app, [v36]);
var v37 = app.router;
JAM.call(app.use, app, [v37]);
var v38 = routes.index;
JAM.call(app.get, app, ["/", v38], JAM.policy.p1);
var v39 = routes.doc;
JAM.call(app.get, app, ["/doc", v39], JAM.policy.p1);
var v40 = routes.done;
JAM.call(app.get, app, ["/done", v40], JAM.policy.p1);
var setup = require("./routes/setup");
var v41 = setup.index;
JAM.call(app.get, app, ["/setup", v41], JAM.policy.p1);
var v42 = setup.add_token;
JAM.call(app.post, app, ["/setup/add_token", v42], JAM.policy.p1);
JAM.call(app.use, app, [v7]);
var v61 = app.get("env");
var v43 = v61 === "development";
if (v43) {
  JAM.call(app.use, app, [v8]);
}
JAM.call(app.use, app, [v9]);
module.exports = app

JAM.stopProfile('load');
