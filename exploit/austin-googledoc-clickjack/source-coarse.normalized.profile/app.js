
JAM.startProfile('load');
introspect(JAM.policy.pFull) {
function v9(err$$5, req$$2, res$$2, next$$2) {
  var v44 = err$$5.message;
  var v10 = {message:v44, error:{}};
  res$$2.render("error", v10);
  return;
}
function v8(err$$4, req$$1, res$$1, next$$1) {
  var v45 = err$$4.message;
  var v11 = {message:v45, error:err$$4};
  res$$1.render("error", v11);
  return;
}
function v7(req, res, next) {
  var err$$3 = new Error("Not Found");
  err$$3.status = 404;
  next(err$$3);
  return;
}
function v6(message$$10) {
  function v5(err$$2) {
    var v12 = err$$2 || "success, message deleted";
    console.log(v12);
    return;
  }
  var v13 = message$$10.title;
  ses = v13.match(/session_id\:(\w+)/);
  if (ses) {
    var v14 = message$$10.UID;
    mail_client.deleteMessage(v14, v5);
    var v46 = sessionStore.sessions;
    var v47 = ses[1];
    var v20 = v46[v47];
    if (v20) {
      var v68 = ses[1];
      var v62 = "Setting session: " + v68;
      var v48 = v62 + "to: ";
      var v63 = message$$10.from;
      var v49 = v63.address;
      var v15 = v48 + v49;
      console.log(v15);
      var v50 = sessionStore.sessions;
      var v51 = ses[1];
      var v16 = v50[v51];
      session_data = JSON.parse(v16);
      var v17 = message$$10.from;
      session_data.name = v17.name;
      var v18 = message$$10.from;
      session_data.email = v18.address;
      var v19 = ses[1];
      sessionStore.set(v19, session_data);
    }
  }
  return;
}
function v4() {
  function v3(error$$1, info) {
    function v2(err, messages) {
      function v1(message$$9) {
        function v0(err$$1, flags$$1) {
          console.log("Current flags for a message: ", flags$$1);
          return;
        }
        var v64 = message$$9.UID;
        var v52 = v64 + ": ";
        var v53 = message$$9.title;
        var v21 = v52 + v53;
        console.log(v21);
        var v22 = message$$9.UID;
        var v23 = ["\\Seen"];
        mail_client.addFlags(v22, v23, v0);
        return;
      }
      messages.forEach(v1);
      return;
    }
    if (error$$1) {
      throw error$$1;
    }
    var v54 = info.count;
    var v24 = "Message count in INBOX: " + v54;
    console.log(v24);
    mail_client.listMessages(0, 0, v2);
    return;
  }
  mail_client.openMailbox("INBOX", v3);
  return;
}
var express = require("express");
var connect = require("connect");
var googleapis = require("googleapis");
var http = require("http");
var path = require("path");
var favicon = require("static-favicon");
var logger = require("morgan");
var cookieParser = require("cookie-parser");
var bodyParser = require("body-parser");
var routes = require("./routes");
var util = require("util");
var inbox = require("inbox");
var CLIENT_ID = "some_client_id_asdfasdfasd.apps.googleusercontent.com";
var CLIENT_SECRET = "client1234secret";
var REDIRECT_URL = "urn:ietf:wg:oauth:2.0:oob";
var IMAP_EMAIL = "someemail@gmail.com";
var IMAP_PASSWORD = "somepassword";
var v55 = {user:IMAP_EMAIL, pass:IMAP_PASSWORD};
var v25 = {secureConnection:true, auth:v55};
var mail_client = inbox.createConnection(false, "imap.gmail.com", v25);
var OAuth2Client = googleapis.OAuth2Client;
app = express();
var v26 = app;
var v73 = new OAuth2Client(CLIENT_ID, CLIENT_SECRET, REDIRECT_URL);
v26.oauth2Client = v73;
var v27 = path.join(__dirname, "views");
app.set("views", v27);
app.set("view engine", "ejs");
var v28 = favicon();
app.use(v28);
var v29 = logger("dev");
app.use(v29);
var v30 = bodyParser.json();
app.use(v30);
var v31 = bodyParser.urlencoded();
app.use(v31);
var v56 = connect.session;
var v32 = v56.MemoryStore;
sessionStore = new v32;
SITE_SECRET = "asdfasKLAJHFasdfasd";
var v33 = express.cookieParser(SITE_SECRET);
app.use(v33);
var v71 = Date.now();
var v69 = v71 + 36E5;
var v65 = new Date(v69);
var v72 = Date.now();
var v70 = v72 + 36E5;
var v66 = new Date(v70);
var v57 = {key:"express.sid", maxAge:v65, expires:v66, store:sessionStore};
var v34 = express.session(v57);
app.use(v34);
mail_client.on("connect", v4);
mail_client.on("new", v6);
mail_client.connect();
var v58 = require("less-middleware");
var v67 = path.join(__dirname, "public");
var v59 = {src:v67};
var v35 = v58(v59);
app.use(v35);
var v60 = path.join(__dirname, "public");
var v36 = express.static(v60);
app.use(v36);
var v37 = app.router;
app.use(v37);
var v38 = routes.index;
app.get("/", v38);
var v39 = routes.doc;
app.get("/doc", v39);
var v40 = routes.done;
app.get("/done", v40);
var setup = require("./routes/setup");
var v41 = setup.index;
app.get("/setup", v41);
var v42 = setup.add_token;
app.post("/setup/add_token", v42);
app.use(v7);
var v61 = app.get("env");
var v43 = v61 === "development";
if (v43) {
  app.use(v8);
}
app.use(v9);
module.exports = app

}

JAM.stopProfile('load');
